{% load static %}
<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>fitByte</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" rel="stylesheet">
</head>

<body>

    <div class="container-fluid" style="background: #535f8c;
    color: white;">
        {% include 'navbar.html' %}

        <!-- Messages -->
        <!-- Button trigger modal -->
        <button type="button" class="btn btn-primary d-none" id="display-msg-btn" data-bs-toggle="modal"
            data-bs-target="#exampleModal">
            Launch demo modal
        </button>

        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-modal="true"
            role="dialog">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content" style="
      background: transparent;
      border: none;
  ">
                    <div class="modal-header" style="
      background: transparent;
      border: none;
  ">

                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body w-75 mx-auto rounded-3" style="
      /* color: white; */
      background: black;
  ">
                        <h4 class="fs-4" style="
      text-align: center;
  ">You need more coins</h4>
                        <p class="fs-6 mb-0">Pro Tip: Eat healthy &amp; earn more</p>
                    </div>

                </div>
            </div>
        </div>
        <!-- End Messages -->

        <div class="container-fluid p-0">
            <div class="container-fluid">
                <div class="card rounded-5" style="
            border: none; background: #373f5d;
        ">
                    <img src="static/images/girl.png" class="card-img-top mx-auto" alt="avatar" style="
            width: 11rem;
        ">
                    <div class="card-body pb-0" style="position: relative;top: -2rem;/* width: max-content; */">
                        <div class="container-fluid border rounded-pill" style="
            width: max-content;
            background: #5d5b5b;
            color: white;
        ">
                            <p class="card-text fs-3" style="
            width: max-content;
        ">{{stat}}</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container p-0">
                <div class="container-fluid p-0">
                    <div class="container-fluid p-0 d-flex align-items-center">
                        <img class="rounded-circle" src="static/images/green-energy.png" width="50" height="50" style="
    /* border: none; */
    border: 1px solid black;
    /* margin-right: 1rem; */
">
                        <div class="container-fluid">

                            <div class="container-fluid p-0 d-flex justify-content-between">
                                <h6 class="fs-6" style="
    margin-top: 0.5rem;
">Level {{lvl}}</h6>
                                <h6 class="fs-6" style="
    margin-top: 0.5rem;
">Level {{nxt_lvl}}</h6>
                            </div>
                            <div class="progress" role="progressbar" aria-label="Success example"
                                aria-valuenow="{{progress}}" aria-valuemin="0" aria-valuemax="100" style="
    width: inherit;
">
                                <div class="progress-bar bg-success" id="xp-progress"></div>
                            </div>
                            <h6 class="fs-6" style="text-align:end;">{{xp}}/{{next_xp}} XP</h6>
                        </div>
                    </div>

                    <div class="container-fluid mt-3 d-flex justify-content-between mb-5">
                        <div class="container-sm card" style="
    width: max-content;
    margin: 0;
    /* margin-right: 1rem; */
">
                            <div class="container-fluid pt-2"><img class="img-thumbnail"
                                    src="static/images/strength.png" width="60" height="60"></div>
                            <h4 class="fs-4">Muscles</h4>
                            <div class="container-fluid">

                                <i class="fa fa-star muscle-star"></i><i class="fa fa-star muscle-star"></i><i
                                    class="fa fa-star muscle-star"></i>
                            </div>
                            <button class="btn btn-light d-flex align-items-center mx-auto mb-2 mt-2"
                                onclick="buyMuscle()" type="button" style="
    width: fit-content;
    width: max-content;
    background: #373f5d;
    color: white;
">
                                <img src="static/images/proto.png" width="20" height="20">
                                <p class="p m-0">{{protos_cost}}</p>

                            </button>
                        </div>
                        <div class="container-sm card" style="
    width: max-content;
    margin: 0;
">
                            <div class="container-fluid pt-2"><img class="img-thumbnail"
                                    src="static/images/exercise.png" width="60" height="60"></div>
                            <h5 class="fs-5">Strength</h5>
                            <div class="container-fluid">

                                <i class="fa fa-star strength-star"></i><i class="fa fa-star strength-star"></i><i
                                    class="fa fa-star strength-star"></i>
                            </div>
                            <button class="btn btn-light d-flex align-items-center mx-auto mb-2 mt-2"
                                onclick="buyStrength()" type="button" style="
    width: fit-content;
    width: max-content;
    background: #373f5d;
    color: white;
">
                                <img src="static/images/carbo.png" width="20" height="20">
                                <p class="p m-0">{{carbos_cost}}</p>

                            </button>
                        </div>
                        <div class="container-sm card" style="
    width: max-content;
    margin: 0;
">
                            <div class="container-fluid pt-2"><img class="img-thumbnail"
                                    src="static/images/physique.png" width="60" height="60"></div>
                            <h5 class="fs-5">Physique</h5>
                            <div class="container-fluid">

                                <i class="fa fa-star physique-star"></i><i class="fa fa-star physique-star"></i><i
                                    class="fa fa-star physique-star"></i>
                            </div>

                            <button class="btn btn-light d-flex align-items-center mx-auto mb-2 mt-2"
                                onclick="buyPhysique()" type="button" style="
    width: fit-content;
    width: max-content;
    background: #373f5d;
    color: white;
">
                                <img src="static/images/fatto.png" width="20" height="20">
                                <p class="p m-0">{{fatos_cost}}</p>

                            </button>
                        </div>
                    </div>
                    <div class="container-fluid d-flex justify-content-between mb-5" style="
    visibility: hidden;
">
                        <div class="container-sm card" style="
    width: max-content;
    margin: 0;
    /* margin-right: 1rem; */
">
                            <div class="container-fluid pt-2"><img class="img-thumbnail"
                                    src="static/images/strength.png" width="60" height="60"></div>
                            <h4 class="fs-4">Muscles</h4>
                            <div class="container-fluid">

                                <i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>
                            </div>
                            <button class="btn btn-light" type="button">
                                <p class="p">450</p>
                                <img src="static/images/proto.png" width="20" height="20">
                            </button>
                        </div>
                        <div class="container-sm card" style="
    width: max-content;
    margin: 0;
">
                            <div class="container-fluid pt-2"><img class="img-thumbnail"
                                    src="static/images/exercise.png" width="60" height="60"></div>
                            <h5 class="fs-5">Strength</h5>
                            <div class="container-fluid">

                                <i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>
                            </div>
                        </div>
                        <div class="container-sm card" style="
    width: max-content;
    margin: 0;
">
                            <div class="container-fluid pt-2"><img class="img-thumbnail"
                                    src="static/images/physique.png" width="60" height="60"></div>
                            <h5 class="fs-5">Physique</h5>
                            <div class="container-fluid">

                                <i class="fa fa-star"></i><i class="fa fa-star"></i><i class="fa fa-star"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        progress_bar = document.getElementById('xp-progress')
        prog = "{{progress}}"
        progress_bar.style.width = `${prog}%`

        muscle_stars = document.getElementsByClassName('muscle-star')
        muscle_no = parseInt("{{muscle}}") - 1

        for (let i = 0; i < muscle_no; i++) {
            muscle_stars[i].style.color = '#ff9f40'
        }

        strength_stars = document.getElementsByClassName('strength-star')
        strength_no = parseInt("{{strength}}") - 1

        for (let i = 0; i < strength_no; i++) {
            strength_stars[i].style.color = '#0050c0'
        }

        physique_stars = document.getElementsByClassName('physique-star')
        physique_no = parseInt("{{physique}}") - 1

        for (let i = 0; i < physique_no; i++) {
            physique_stars[i].style.color = '#f53241'
        }
    })

    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    function buyMuscle() {
        csrftoken = getCookie('csrftoken');
        protos_cost = parseInt("{{protos_cost}}");
        protos = parseInt("{{protos}}");

        if (protos < protos_cost) {
            disp_msg_btn = document.getElementById('display-msg-btn')
            disp_msg_btn.click()
        }

        else {
            data = {
                'category': 'muscle',
                'cost': "{{protos_cost}}"
            }

            fetch("/buycategory", {
                method: "POST",
                body: JSON.stringify(data),
                headers: {
                    "Content-type": "application/json; charset=UTF-8",
                    "X-CSRFToken": csrftoken
                }
            }).then((response) => response = response.json()).then((response) => {
                protos_c = document.getElementById('protos-c')
                protos_c.innerText = `${response.val}`
                star = response.star
                muscle_stars = document.getElementsByClassName('muscle-star')
                for (let i = 0; i < star; i++) {
                    muscle_stars[i].style.color = '#ff9f40'
                }
                progress_bar = document.getElementById('xp-progress')
                prog = response.prog
                progress_bar.style.width = `${prog}%`

            })
        }

    }


    function buyStrength() {
        csrftoken = getCookie('csrftoken');
        carbos_cost = parseInt("{{carbos_cost}}");
        carbos = parseInt("{{carbos}}");
        console.log(carbos, carbos_cost)

        if (carbos < carbos_cost) {
            disp_msg_btn = document.getElementById('display-msg-btn')
            disp_msg_btn.click()
        }

        else {
            data = {
                'category': 'strength',
                'cost': "{{carbos_cost}}"
            }

            fetch("/buycategory", {
                method: "POST",
                body: JSON.stringify(data),
                headers: {
                    "Content-type": "application/json; charset=UTF-8",
                    "X-CSRFToken": csrftoken
                }
            }).then((response) => response = response.json()).then((response) => {
                carbos_c = document.getElementById('carbos-c')
                carbos_c.innerText = `${response.val}`
                star = response.star
                strength_stars = document.getElementsByClassName('strength-star')
                for (let i = 0; i < star; i++) {
                    strength_stars[i].style.color = '#0050c0'
                }
                progress_bar = document.getElementById('xp-progress')
                prog = response.prog
                progress_bar.style.width = `${prog}%`

            })
        }

    }

    function buyPhysique() {
        csrftoken = getCookie('csrftoken');
        fatos_cost = parseInt("{{fatos_cost}}");
        fatos = parseInt("{{fatos}}");

        if (fatos < fatos_cost) {
            disp_msg_btn = document.getElementById('display-msg-btn')
            disp_msg_btn.click()
        }

        else {
            data = {
                'category': 'physique',
                'cost': "{{fatos_cost}}"
            }

            fetch("/buycategory", {
                method: "POST",
                body: JSON.stringify(data),
                headers: {
                    "Content-type": "application/json; charset=UTF-8",
                    "X-CSRFToken": csrftoken
                }
            }).then((response) => response = response.json()).then((response) => {
                fatos_c = document.getElementById('fatos-c')
                fatos_c.innerText = `${response.val}`
                star = response.star
                physique_stars = document.getElementsByClassName('physique-star')
                for (let i = 0; i < star; i++) {
                    physique_stars[i].style.color = '#f53241'
                }
                progress_bar = document.getElementById('xp-progress')
                prog = response.prog
                progress_bar.style.width = `${prog}%`

            })
        }

    }
</script>

</html>